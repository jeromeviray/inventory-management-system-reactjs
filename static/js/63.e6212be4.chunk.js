(this["webpackJsonp@project/inventory-management-system"]=this["webpackJsonp@project/inventory-management-system"]||[]).push([[63],{1008:function(e,t,s){"use strict";s.r(t),s.d(t,"ProductEditorModal",(function(){return N}));var a=s(0),o=s(51),r=s(412),i=s(444),n=s(457),c=s(1009),d=s.n(c),l=s(451),p=s(1011),m=s(416),h=s(413),g=s(418),u=s(482),b=s(515),j=s(432),O=s(694),x=s(695),f=s(8);class N extends a.Component{constructor(e){super(e),this.productDetail={productName:"",productPrice:0,productDescriptions:"",barcode:"",brandName:"",brandId:"",categoryName:"",categoryId:"",threshold:0,productId:""},this.onResetValue=()=>{this.setState((()=>this.productDetail))},this.getCategories=()=>{this.props.getCategories().catch((()=>{let{status:e,data:t}=this.props.messageResponse;this.setState({message:t.message})}))},this.getBrands=()=>{this.props.getBrands().catch((()=>{let e=this.props.messageResponse;this.setState({message:e.data.message})}))},this.componentDidUpdate=(e,t)=>{this.manageModalVisible(e,t),this.manageBrandsResponse(e,t),this.manageCategoryResponse(e,t),this.manageScannerResponse(e,t)},this.manageBrandsResponse=(e,t)=>{if(e.brandResponse!==this.props.brandResponse){let{status:e,action:t,data:s}=this.props.brandResponse;200===e&&"GETBRANDS"===t&&this.setState({brands:s.brands})}},this.manageCategoryResponse=(e,t)=>{if(e.categoryResponse!==this.props.categoryResponse){let{action:e,data:t,status:s}=this.props.categoryResponse;"GET_CATEGORIES"===e&&200===s&&this.setState({categories:t.categories})}},this.manageModalVisible=(e,t)=>{if(e.modalVisibleResponse!==this.props.modalVisibleResponse){let{action:e,visible:t,icon:s}=this.props.modalVisibleResponse;if(console.log(this.props.modalVisibleResponse),"Add"===e)this.setState({visible:t,action:e,icon:s});else if("Edit"===e){let{product:e,action:t,visible:s,icon:a}=this.props.modalVisibleResponse,{productName:o,productDescription:r,barcode:i,productPrice:n,brand:c,category:d,fileImages:p,id:m}=e;this.setState({visible:s,action:t,icon:a,productName:o,productPrice:n,barcode:i,brandName:c&&c.brand,categoryName:d&&d.name,productId:m,editorState:r?l.EditorState.createWithContent(Object(l.convertFromRaw)(JSON.parse(r))):l.EditorState.createEmpty()}),this.getImages(p)}else"close"===e&&(this.props.clearMessage(),this.setState({visible:this.props.modalVisibleResponse.visible,productName:"",productPrice:"",barcode:"",brandName:"",categoryName:"",editorState:l.EditorState.createEmpty(),productImage:[],removedImages:[]}))}},this.loadImage=(e,t)=>{let{productImage:s}=this.state;if(!e)return;let a=new FileReader;a.onloadend=()=>{s.push({data_url:a.result,file:null,image_created:!0,filename:t}),this.setState({productImage:s})},e&&a.readAsDataURL(e)},this.handleVisibility=e=>{this.setState({visible:!1})},this.handleImageOnchange=(e,t)=>{this.setState({productImage:e})},this.onEditorStateChange=e=>{e.getCurrentContent();this.setState({editorState:e})},this.handleOnChange=e=>{let t=e.target.name;this.setState({[t]:e.target.value})},this.handleSubmit=e=>{e.preventDefault();let{action:t}=this.state;this.setState({loading:!0}),"Add"===t?this.saveProduct():"Edit"===t?this.editProduct():this.setState({visible:this.props.modalVisibleResponse.visible})},this.saveProduct=()=>{let{productName:e,productPrice:t,productImage:s,barcode:a,editorState:o,categoryName:r,brandName:i}=this.state,n=new FormData;if(s.length>0)for(let c=0;c<s.length;c++)s[c].file&&n.append("productImages[]",s[c].file);else n.append("productImages[]",s);n.append("barcode",a),n.append("productName",e),n.append("productPrice",t),n.append("brandName",i),n.append("categoryName",r),n.append("productDescription",JSON.stringify(Object(l.convertToRaw)(o.getCurrentContent()))),this.props.saveProduct(n).then((()=>{this.onResetValue();200===this.props.messageResponse.status?this.setState({loading:!1,successFully:!0,editorState:l.EditorState.createEmpty(),productImage:[]}):this.setState({loading:!1,productImage:[],successFully:!1,editorState:l.EditorState.createEmpty()})})).catch((()=>{this.onResetValue(),this.setState({loading:!1,productImage:[],editorState:l.EditorState.createEmpty()})}))},this.editProduct=()=>{let{productName:e,productPrice:t,productImage:s,barcode:a,editorState:o,categoryName:r,brandName:i,productId:n,removedImages:c}=this.state,d=new FormData;if(s.length>0)for(let l=0;l<s.length;l++)s[l].file&&d.append("productImages[]",s[l].file);else d.append("productImages[]",s);d.append("removedImages[]",c),d.append("barcode",a),d.append("productName",e),d.append("productPrice",t),d.append("brandName",i),d.append("categoryName",r),d.append("productDescription",JSON.stringify(Object(l.convertToRaw)(o.getCurrentContent()))),this.props.updateProduct(n,d).then((()=>{const{status:e}=this.props.messageResponse;200===e?this.setState({loading:!1,successFully:!0}):this.setState({loading:!1,successFully:!1})})).catch((()=>{let{status:e,data:t}=this.props.messageResponse;this.setState({loading:!1})}))},this.manageScannerResponse=(e,t)=>{if(e.scannerResponse!==this.props.scannerResponse){let{action:e,decoded:t}=this.props.scannerResponse;console.log(this.props.scannerResponse),"inputBarcode"===e&&this.setState({barcode:t})}},this.removeImage=this.removeImage.bind(this),this.state={visible:!1,alert:!0,loading:!1,successFully:!1,message:"",status:"",productDetails:this.productDetail,action:"",icon:"",images:[],productImage:[],removedImages:[],editorState:l.EditorState.createEmpty(),autoGenerateBarcode:!1,brands:[],categories:[]}}componentDidMount(){this.loadImage(),this.getBrands(),this.getCategories()}async getImages(e){for(let t=0;t<e.length;t++)j.a.getImage(e[t].path,e[t].fileName).then((s=>{this.loadImage(s.data,e[t].fileName)})).catch((e=>{const t=e.response&&e.response.data&&e.response.data.message||e.message||e.error_message||e.toString(),s=e.response&&e.response.data&&e.response.data.code||e.status||e.toString();this.setState({status:s,message:t})}))}removeImage(e){let{productImage:t,removedImages:s}=this.state;t[e].filename&&s.push(t[e].filename)}render(){let{visible:e,alert:t,productName:s,productPrice:a,productImage:o,barcode:c,editorState:l,loading:m,successFully:h,message:g,action:u,icon:b,categoryName:j,categoryId:x,brandName:N,brandId:S,threshold:y,autoGenerateBarcode:v,brands:R,categories:C}=this.state;const I={fontWeight:"600",fontSize:"16px"};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(O.a,{}),Object(f.jsxs)(r.O,{size:"xl",visible:e,fullscreen:"lg",scrollable:!0,children:[Object(f.jsx)(r.R,{onDismiss:()=>{this.props.setProductModal(!1,"close")},className:"modal-header",children:Object(f.jsxs)(r.S,{children:[u," Product"]})}),Object(f.jsx)(r.A,{onSubmit:this.handleSubmit,className:"modal-product-form",id:"a-form",children:Object(f.jsxs)(r.P,{children:[g&&Object(f.jsx)("div",{className:"form-group",children:Object(f.jsx)("div",{className:h?"alert alert-success":"alert alert-danger",role:"alert",children:g})}),Object(f.jsx)(r.a,{color:"warning",dismissible:!0,visible:t,children:Object(f.jsx)("strong",{children:"Maximum 10 images"})}),Object(f.jsx)(d.a,{multiple:!0,value:o,onChange:this.handleImageOnchange,maxNumber:10,dataURLKey:"data_url",onError:()=>this.setState({toastVisible:!1}),children:({imageList:e,onImageUpload:t,onImageRemove:s,isDragging:a,dragProps:o})=>Object(f.jsxs)("div",{className:"upload__image-wrapper",children:[Object(f.jsx)(r.r,{className:"upload-container",children:Object(f.jsx)(r.f,{color:"secondary",className:"upload-btn",style:a?{backgroundColor:"#8E9293",border:"4px dashed #ffffff"}:void 0,onClick:t,...o,children:"Select Image or Drag Here"})}),Object(f.jsx)(r.ab,{className:" images-contianer shadow ",children:e.map(((e,t)=>Object(f.jsx)(r.p,{sm:"4",md:"2",lg:"3",children:Object(f.jsxs)("div",{className:"image-item d-flex ",children:[Object(f.jsx)("img",{src:e.data_url,alt:"",width:"100"}),Object(f.jsx)("div",{className:"image-item__btn-wrapper",children:Object(f.jsx)(i.b,{size:30,color:"#FF0000",onClick:()=>{this.removeImage(t),s(t)}})})]})},t)))})]})}),Object(f.jsxs)(r.ab,{className:"mt-5",children:[Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)(r.E,{className:"mb-3",children:[Object(f.jsx)(r.C,{type:"text",id:"floatingInputProductName",placeholder:"Product Name",name:"productName",value:s,onChange:this.handleOnChange,required:!0}),Object(f.jsx)(r.F,{htmlFor:"floatingInputProductName",children:"Product Name"})]})}),Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)(r.E,{className:"mb-3",children:[Object(f.jsx)(r.C,{type:"number",id:"floatingProductPrice",placeholder:"Product Price",name:"productPrice",value:a,onChange:this.handleOnChange,required:!0}),Object(f.jsx)(r.F,{htmlFor:"floatingInput",children:"Product Price"})]})}),Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[Object(f.jsxs)(r.E,{className:"mb-3 w-100",children:[Object(f.jsx)(r.C,{type:"number",id:"floatingBarcode",placeholder:"Product Barcode",name:"barcode",value:c,onChange:this.handleOnChange,required:!0,disabled:"Edit"===u}),Object(f.jsx)(r.F,{htmlFor:"floatingBarcode",children:"Product Barcode"})]}),Object(f.jsx)("div",{children:Object(f.jsx)(r.f,{className:"pt-2 pb-2 ms-2",type:"button",color:"info",variant:"outline",id:"btn-scan-barcode",onClick:()=>this.props.setScanModal(!0,"inputBarcode"),children:Object(f.jsx)(n.a,{size:"24"})})})]})}),Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)(r.E,{className:"mb-3",children:[Object(f.jsx)(r.C,{type:"number",id:"floatingThreshold",placeholder:"Product Threshold",name:"threshold",value:y,onChange:this.handleOnChange}),Object(f.jsx)(r.F,{htmlFor:"floatingThreshold",children:"Product Threshold"})]})}),Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)(r.E,{className:"mb-3",children:[Object(f.jsxs)(r.G,{value:N,onChange:this.handleOnChange,name:"brandName",id:"floatingSelectBrand","aria-label":"Brand Names",children:[Object(f.jsx)("option",{value:"",children:"Choose Brand"}),R.data&&R.data.map(((e,t)=>Object(f.jsx)("option",{value:e.brandName,style:{...I},children:e.brandName},t)))]}),Object(f.jsx)(r.F,{htmlFor:"floatingSelectBrand",children:"Brand"})]})}),Object(f.jsx)(r.p,{sm:"12",md:"6",lg:!0,children:Object(f.jsxs)(r.E,{className:"mb-3",children:[Object(f.jsxs)(r.G,{value:j,onChange:this.handleOnChange,name:"categoryName",id:"floatingSelectCategory","aria-label":"Categories",children:[Object(f.jsx)("option",{value:"",children:"Choose Category"}),C.data&&C.data.map(((e,t)=>Object(f.jsx)("option",{value:e.categoryName,style:{...I},children:e.categoryName},t)))]}),Object(f.jsx)(r.F,{htmlFor:"floatingSelectCategory",children:"Category"})]})}),Object(f.jsx)(r.p,{sm:"12",md:"12",lg:"12",children:Object(f.jsx)(p.Editor,{editorState:l,wrapperClassName:"editor-wrapper",editorClassName:"editor",onEditorStateChange:this.onEditorStateChange,placeholder:"Product Description",toolbar:{options:["inline","blockType","fontSize","fontFamily","list","textAlign","colorPicker","emoji","remove","history"]}})})]})]})}),Object(f.jsxs)(r.Q,{className:"modal-footer",children:[Object(f.jsx)(r.f,{color:"secondary",variant:"ghost",onClick:()=>this.props.setProductModal(!e,"close"),className:"text-body",children:"Close"}),Object(f.jsxs)(r.f,{type:"submit",color:"info",form:"a-form",className:"d-flex justify-content-center align-items-center position-relative ",disabled:m,children:[m?Object(f.jsx)(r.fb,{size:"sm"}):Object(f.jsx)("span",{className:"d-flex align-items-center login-icon me-2",children:b}),"Edit"===u?"Update":"Create"," Product"]})]})]})]})}}t.default=Object(o.b)((e=>({modalVisibleResponse:e.modalVisibleResponse,messageResponse:e.messageResponse,credentials:e.userResponse.credentials,productResponse:e.productResponser,brandResponse:e.brandResponse,categoryResponse:e.categoryResponse,scannerResponse:e.scannerResponse})),{setProductModal:h.k,saveProduct:m.i,clearMessage:g.a,getImage:m.c,getCategories:u.b,getBrands:b.b,updateProduct:m.k,setScanModal:h.m,getDecodedBarcode:x.a})(N)}}]);
//# sourceMappingURL=63.e6212be4.chunk.js.map