(this["webpackJsonp@project/inventory-management-system"]=this["webpackJsonp@project/inventory-management-system"]||[]).push([[41],{1151:function(e,t,s){"use strict";s.r(t),s.d(t,"Orders",(function(){return u}));var r=s(0),a=s(428),d=s(129),n=s(700),i=s(503),o=s(431),c=s(55),l=s(561),p=s(130),m=(s(443),s(25)),h=s(8);class u extends r.Component{constructor(e){super(e),this.state={message:"",status:"",action:"",orders:[],token:"",permission:"",path:"",updated:!1},this.orderReviews={},this.manageorderRepsonse=(e,t)=>{if(e.orderResponse!==this.props.orderResponse){let{status:e,action:t,data:s}=this.props.orderResponse;200===e&&"GET_ORDERS"===t&&this.setState({orders:s.orders})}},this.manageHrefLinkBasedInPermission=e=>e===p.a.SUPER_ADMIN||e===p.a.ADMIN?"/app/order/":"/user/order/",this.renderCustomerAction=(e,t,s)=>{console.log(s);let r=Object(h.jsx)(h.Fragment,{});switch(e.toLowerCase()){case"pending":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"cancel")},children:"Cancel Order"});break;case"delivered":r="Paid"===s?Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"request_refund")},children:"Request Refund"}):Object(h.jsx)(h.Fragment,{})}return r},this.state.status=e.status,this.handleOrderReview=this.handleOrderReview.bind(this)}componentDidMount(){let{type:e,accessToken:t,roles:s}=this.props.userResponse.credentials,r=e+t,a=s.roleName,d=a||s,n=this.manageHrefLinkBasedInPermission(d);this.setState({token:r,permission:s.roleName?s.roleName:s,path:n}),this.props.getOrders(this.state.status)}componentDidUpdate(e,t){this.manageorderRepsonse(e,t)}handleOrder(e,t){let s=e.orderId;this.props.updateOrderStatus(s,t).then((()=>{let r=this.state.orders;this.props.orderResponse.data;const a=r.findIndex((e=>e.orderId==s));if(r.splice(a,1),0==r.length)this.props.getOrders(this.state.status,0,10);else{let s=this.props.totalCounts;"undefined"==typeof s[t.toUpperCase()]&&(s[t.toUpperCase()]=0),"payment_received"==t&&(s[e.orderStatus.toUpperCase()]--,s[t.toUpperCase()]++,this.props.totalCountChange(s),this.setState({orders:r}))}}))}renderOrderAction(e,t,s){let r=Object(h.jsx)(h.Fragment,{});switch(e.toLowerCase()){case"pending":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"confirmed")},children:"Confirm Order"});break;case"confirmed":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"shipped")},children:"Mark as Shipped"});break;case"shipped":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"delivered")},children:"Mark as Delivered"});break;case"delivered":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"payment_received")},disabled:"Paid"===s,children:"Paid"===s?"Payment Recieved":"Mark as Payment Received"});break;case"request_refund":r=Object(h.jsx)(a.f,{onClick:()=>{this.handleOrder(t,"accept_refund")},children:"Accept Refund"})}return r}handleOrderView(e,t){e.preventDefault();let s=[],r=this.orderReviews[t.orderId];for(var a in r){let e=r[a];s.push({rating:e.rating,message:e.comment,anonymous:!0,published:0,product:{id:parseInt(a)}}),this.orderReviews[t.orderId][a].submitted=!0}this.props.saveComments(t.orderId,s),this.setState({update:!0})}handleOrderReview(e,t,s,r){const{orders:a}=this.state;let d=a.findIndex((t=>t.orderId==e)),{comments:n}=a[d],i=!1;"undefined"==typeof this.orderReviews[e]?this.orderReviews[e]={[t.product.id]:{rating:s,comment:r,submitted:!1}}:"undefined"!==typeof this.orderReviews[e][t.product.id]&&this.orderReviews[e][t.product.id].submitted&&(r=this.orderReviews[e][t.product.id].comment,i=this.orderReviews[e][t.product.id].submitted);let o=n&&n.findIndex((e=>e.product.id==t.product.id));if(o>=0){const e=n[o];s=e.rating,r=e.message,i=!0}this.orderReviews[e][t.product.id]={rating:s,comment:r,submitted:i}}render(){let{message:e,orders:t,permission:s,path:r}=this.state;const n={fontSize:"14px",fontWeight:"400"};return Object(h.jsx)(h.Fragment,{children:0===t.length?Object(h.jsx)(a.i,{children:Object(h.jsx)(a.j,{children:Object(h.jsx)("div",{className:"text-center",children:"No Order Data"})})}):t.map(((e,t)=>{let i=e.orderItems.length!=e.comments.length;if(i&&this.orderReviews[e.orderId])for(var o in i=!1,this.orderReviews[e.orderId])0==this.orderReviews[e.orderId][o].submitted&&(i=!0);const c=("DELIVERED"==e.orderStatus||"PAYMENT_RECEIVED"==e.orderStatus)&&s!==p.a.SUPER_ADMIN&&s!==p.a.ADMIN,u=("DELIVERED"==e.orderStatus||"PAYMENT_RECEIVED"==e.orderStatus)&&(s==p.a.SUPER_ADMIN||s==p.a.ADMIN),{firstName:j,lastName:O,street:b,barangay:g,province:x,region:y,city:f,phoneNumber:v}=e.customerAddress;let R="Payment Pending";switch(e.paymentStatus){case 1:R="Paid";break;case 2:R="Failed";break;case 3:R="Refunded"}return Object(h.jsxs)(a.i,{className:"mb-3",children:[Object(h.jsx)(a.m,{children:Object(h.jsxs)(a.bb,{className:"p-2",children:[Object(h.jsxs)("span",{style:{fontSize:"14px",fontWeight:"400"},className:"text-black-50",children:["Order ID: ",e.orderId]}),Object(h.jsxs)("span",{style:{fontSize:"14px",fontWeight:"400"},className:"text-black-50",children:["Customer Name: ",j+" "+O]}),Object(h.jsxs)("span",{style:{fontSize:"14px",fontWeight:"400"},className:"text-black-50",children:["Mobile: ",v]}),Object(h.jsxs)("span",{style:{fontSize:"14px",fontWeight:"400"},className:"text-black-50",children:["Address:"," ",b+"  "+g+", "+f+", "+x]})]})}),Object(h.jsx)(a.j,{children:Object(h.jsxs)(a.B,{onSubmit:t=>{this.handleOrderView(t,e)},children:[Object(h.jsx)(a.s,{children:e.orderItems.map(((t,s)=>{this.handleOrderReview(e.orderId,t,5,"");const{rating:r,comment:a,submitted:d}=this.orderReviews[e.orderId][t.product.id];return Object(h.jsx)(l.a,{item:t,canReview:c,canViewReview:u,orderId:e.orderId,comment:a,rating:r,submitted:d,handleOrderReview:this.handleOrderReview},s)}))},new Date),i&&c&&Object(h.jsx)(a.f,{type:"submit",style:{float:"right"},children:"Submit Product Review"})]})}),Object(h.jsx)(a.k,{className:"p-4",children:Object(h.jsxs)(a.bb,{className:"",children:[Object(h.jsx)(a.q,{sm:"12",lg:"6",children:Object(h.jsxs)("div",{className:"d-flex flex-column",children:[Object(h.jsxs)("div",{style:n,className:"mt-2",children:[Object(h.jsx)("span",{className:"text-black-50 me-2",children:"Date of Ordered:"}),Object(h.jsx)("span",{style:{fontWeight:"500"},children:e.orderedAt})]}),Object(h.jsxs)("div",{style:n,className:"mt-2",children:[Object(h.jsx)("span",{style:n,className:"text-black-50 me-2",children:"Payment Method:"}),Object(h.jsx)("span",{style:{fontWeight:"500"},children:e.paymentMethod.paymentMethod})]}),Object(h.jsxs)("div",{style:n,className:"mt-2",children:[Object(h.jsx)("span",{style:n,className:"text-black-50 me-2",children:"Payment Status:"}),Object(h.jsx)("span",{style:{fontWeight:"500"},children:R})]}),Object(h.jsxs)("div",{style:n,className:"mt-2",children:[Object(h.jsx)("span",{style:n,className:"text-black-50 me-2",children:"Order Status:"}),Object(h.jsx)("span",{className:"text-danger",style:{fontWeight:"500"},children:e.orderStatus})]}),Object(h.jsxs)("div",{className:"mt-2",children:[Object(h.jsx)("span",{style:n,className:"text-black-50 me-2",children:"Total Amount"}),Object(h.jsxs)("span",{style:{fontWeight:"500"},children:["\u20b1",e.totalAmount.toFixed(2)]})]})]})}),Object(h.jsx)(a.q,{sm:"12",lg:"6",children:Object(h.jsxs)("div",{className:"d-flex align-items-end  h-100 justify-content-end mt-3",children:[s===p.a.SUPER_ADMIN||s===p.a.ADMIN?this.renderOrderAction(this.state.status,e,R):this.renderCustomerAction(this.state.status,e,R),Object(h.jsx)(d.b,{to:{pathname:m.a.api.private.prefixFrontendUrl+r+e.orderId,state:e.orderId},className:"m-2",children:"View More"})]})})]})})]},t)}))})}}t.default=Object(c.b)((e=>({orderResponse:e.orderResponse,messageResponse:e.messageResponse,userResponse:e.userResponse})),{getOrders:i.c,clearMessage:o.a,updateOrderStatus:i.g,saveComments:n.c})(u)},503:function(e,t,s){"use strict";s.d(t,"c",(function(){return c})),s.d(t,"b",(function(){return l})),s.d(t,"e",(function(){return p})),s.d(t,"a",(function(){return m})),s.d(t,"g",(function(){return h})),s.d(t,"f",(function(){return u})),s.d(t,"d",(function(){return j}));var r=s(2),a=s(14),d=s(128),n=s(56);var i=new class{getOrders(e){return n.a.get("/orders/status/"+e,{headers:Object(d.a)()})}getPaymentTransactions(e,t,s){return n.a.get("/orders/payments",{headers:Object(d.a)(),params:{query:e,page:t,limit:s}})}updateOrderPaymentStatus(e,t){return n.a.put("/orders/"+e+"/paid/"+t,{},{headers:Object(d.a)()})}placeOrderDetails(e){return n.a.post("/orders/checkout",{customerAddressId:e.addressId,paymentId:e.paymentMethodId,cartItems:e.items},{headers:Object(d.a)()})}getOrderByOrderId(e){return n.a.get("/orders/"+e,{headers:Object(d.a)()})}updateOrderStatus(e,t){return n.a.put("/orders/"+e+"/status/"+t,{},{headers:Object(d.a)()})}};const o=(e,t)=>{const s=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();t({type:a.g,payload:{status:r,data:{message:s}}})},c=(e,t,s)=>async a=>i.getOrders(e,t,s).then((e=>(a({type:r.GET_ORDERS,payload:{status:200,action:"GET_ORDERS",data:{orders:e.data.orders,orderStatusCount:e.data.orderCounts}}}),Promise.resolve())),(e=>(o(e,a),Promise.reject()))),l=e=>async t=>{t({type:r.ORDER_ITEMS,payload:{status:200,action:"ORDERITEMS",data:{items:e}}})},p=e=>async t=>i.placeOrderDetails(e).then((e=>(t({type:r.PLACE_ORDER,payload:{status:200,action:"PLACE_ORDER",data:{}}}),t({type:a.g,payload:{status:200,data:{message:"Successfully Place your Order",order:e.data}}}),Promise.resolve())),(e=>(o(e,t),Promise.reject()))),m=e=>async t=>i.getOrderByOrderId(e).then((e=>(t({type:r.GET_ORDER_BY_ID,payload:{status:200,action:"GETORDERBYID",data:{order:e.data}}}),Promise.resolve())),(e=>(o(e,t),Promise.reject()))),h=(e,t)=>async s=>i.updateOrderStatus(e,t).then((d=>(s({type:r.UPDATE_ORDER_STATUS,payload:{status:200,action:r.UPDATE_ORDER_STATUS,data:{order:d.data}}}),s({type:a.g,payload:{status:200,data:{message:"Successfully updated order "+e+" status to "+t.toUpperCase(),order:d.data}}}),Promise.resolve())),(e=>(o(e,s),Promise.reject()))),u=(e,t)=>async s=>i.updateOrderPaymentStatus(e,t).then((e=>(s({type:r.UPDATE_PAYMENT_STATUS,payload:{status:200,action:r.UPDATE_PAYMENT_STATUS,data:{order:e.data}}}),s({type:a.g,payload:{status:200,data:{}}}),Promise.resolve())),(e=>(o(e,s),Promise.reject()))),j=(e,t,s)=>async a=>i.getPaymentTransactions(e,t,s).then((e=>(a({type:r.GET_PAYMENT_TRANSACTIONS,payload:{status:200,action:"GET_PAYMENT_TRANSACTIONS",data:{payments:e.data}}}),Promise.resolve())),(e=>(o(e,a),Promise.reject())))},561:function(e,t,s){"use strict";var r=s(0),a=s(428),d=s(2),n=s(435),i=s.n(n),o=s(25),c=s(8);class l extends r.Component{constructor(e){super(e),this.state={orderItem:this.props.item,canReview:this.props.canReview,orderId:this.props.orderId,comment:this.props.comment,rating:this.props.rating,submitted:this.props.submitted,canViewReview:this.props.canViewReview}}render(){let{orderItem:e,canReview:t,rating:s,comment:r,orderId:n,submitted:l,canViewReview:p}=this.state,m=l;p&&!t&&(l=!0);const h={fontSize:"14px",fontWeight:"400"};return Object(c.jsx)(a.bb,{className:"mb-3",children:Object(c.jsx)(a.i,{children:Object(c.jsx)(a.j,{children:Object(c.jsxs)("div",{className:"d-flex align-items-start",children:[Object(c.jsx)(a.M,{rounded:!0,src:e.product.fileImages.length>0?o.a.api.private.baseUrl+"/api/v1/products/getImages/bytesArrays/"+e.product.fileImages[0].path+e.product.fileImages[0].fileName:d.NO_IMAGE_BASE64,width:100,height:100}),Object(c.jsxs)("div",{className:"ms-2  w-100",children:[Object(c.jsxs)(a.bb,{className:"d-flex justify-content-between",children:[Object(c.jsx)(a.q,{className:"ps-4 text-dark",children:e.product.productName}),Object(c.jsxs)(a.q,{className:"text-dark d-flex flex-column align-items-center",children:[Object(c.jsx)("span",{style:h,className:"text-black-50",children:"Price"}),Object(c.jsxs)("span",{className:"pt-3",children:["\u20b1",e.product.productPrice.toFixed(2)]})]}),Object(c.jsxs)(a.q,{className:"text-dark d-flex flex-column align-items-center",children:[Object(c.jsx)("span",{style:h,className:"text-black-50",children:"Quantity"}),Object(c.jsx)("span",{className:"pt-3",children:e.quantity})]}),Object(c.jsxs)(a.q,{className:"text-dark d-flex flex-column align-items-center",children:[Object(c.jsx)("span",{style:h,className:"text-black-50",children:"Amount"}),Object(c.jsxs)("span",{className:"pt-3",children:["\u20b1",e.amount.toFixed(2)]})]})]}),(t||p&&m)&&Object(c.jsxs)("div",{children:[Object(c.jsx)(i.a,{count:5,value:s,size:24,isHalf:!1,edit:!l,onChange:t=>{this.props.handleOrderReview(n,e,t,r)}}),Object(c.jsx)("div",{className:"mb-!2",children:Object(c.jsx)("textarea",{disabled:l,onChange:t=>{this.props.handleOrderReview(n,e,s,t.target.value)},id:"exampleFormControlTextarea1",rows:"3",style:{width:"100%"},placeholder:"Please write a review.",children:r})})]})]})]})})})})}}t.a=l},700:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return c})),s.d(t,"c",(function(){return l}));var r=s(2),a=s(14),d=s(128),n=s(56);var i=new class{getComments(e,t,s){return n.a.get("/comments",{params:{productId:e,page:t,limit:s}})}saveComment(e){return n.a.post("/comments",e,{headers:Object(d.a)()})}saveComments(e,t){return n.a.post("/comments/bulk/"+e,t,{headers:Object(d.a)()})}deleteComment(e){return n.a.delete("/comments/"+e,{headers:Object(d.a)()})}};const o=(e,t,s)=>async d=>i.getComments(e,t,s).then((e=>(d({type:r.GET_COMMENTS,payload:{status:200,action:"GET_COMMENT",data:e.data}}),Promise.resolve())),(e=>{const t=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),s=e.response&&e.response.data&&e.response.data.code||e.toString();return d({type:a.g,payload:{status:s,data:{message:t}}}),Promise.reject()})),c=e=>async t=>i.saveComment(e).then((e=>(t({type:r.ADD_COMMENT,payload:{status:200,action:"ADD_COMMENT",data:e.data}}),t({type:a.g,payload:{status:200,data:{message:"Successfully submitted product comment",order:e.data}}}),Promise.resolve())),(e=>{const s=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();return t({type:a.g,payload:{status:r,data:{message:s}}}),Promise.reject()})),l=(e,t)=>async s=>i.saveComments(e,t).then((e=>(s({type:r.ADD_COMMENT,payload:{status:200,action:"ADD_COMMENT",data:e.data}}),s({type:a.g,payload:{status:200,data:{message:"Successfully submitted order product review",order:e.data}}}),Promise.resolve())),(e=>{const t=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();return s({type:a.g,payload:{status:r,data:{message:t}}}),Promise.reject()}))}}]);
//# sourceMappingURL=41.ae59f189.chunk.js.map