(this["webpackJsonp@project/inventory-management-system"]=this["webpackJsonp@project/inventory-management-system"]||[]).push([[53],{571:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return i})),s.d(t,"d",(function(){return l})),s.d(t,"c",(function(){return p})),s.d(t,"e",(function(){return h}));var a=s(16),r=s(1),n=s(152),d=s(62);var o=new class{addToCart(e){return d.a.post("/cart/item/add/"+e,{},{headers:Object(n.a)()})}getCart(){return d.a.get("/cart",{headers:Object(n.a)()})}removeItem(e){return d.a.delete("/cart/item/remove/"+e,{headers:Object(n.a)()})}quantityAction(e,t){return d.a.put("/cart/item/"+e+"/quantity/"+t,{},{headers:Object(n.a)()})}};const c=e=>async t=>o.addToCart(e).then((e=>(t({type:r.ADD_TO_CART,payload:{status:200,action:"ADDTOCART",data:{}}}),t({type:a.g,payload:{status:200,data:{message:"Added Successfully"}}}),Promise.resolve())),(e=>{const s=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();return t({type:a.g,payload:{status:r,data:{message:s}}}),Promise.reject()})),i=()=>async e=>o.getCart().then((t=>(e({type:r.GET_CART_ITEMS,payload:{status:200,action:"CARTITEMS",data:{cart:t.data}}}),Promise.resolve())),(t=>{const s=t.response&&t.response.data&&t.response.data.message||t.message||t.toString(),r=t.response&&t.response.data&&t.response.data.code||t.toString();return e({type:a.g,payload:{status:r,data:{message:s}}}),Promise.reject()})),l=e=>async t=>o.removeItem(e).then((e=>(t({type:r.REMOVE_ITEM,payload:{status:200,action:"REMOVE",data:{}}}),t({type:a.g,payload:{status:200,data:{message:"Remove Item Successfully"}}}),Promise.resolve())),(e=>{console.log(e);const s=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();return t({type:a.g,payload:{status:r,data:{message:s}}}),Promise.reject()})),p=(e,t)=>async s=>o.quantityAction(e,t).then((e=>{s({type:r.QUANTITY_ACTION,payload:{status:200,action:r.QUANTITY_ACTION,data:{}}})}),(e=>{const t=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),r=e.response&&e.response.data&&e.response.data.code||e.toString();return s({type:a.g,payload:{status:r,data:{message:t}}}),Promise.reject()})),h=e=>async t=>{t({type:r.GET_CART_ITEMS,payload:{status:200,action:"CARTITEMS",data:{cart:e}}})}},642:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"b",(function(){return l})),s.d(t,"e",(function(){return p})),s.d(t,"a",(function(){return h})),s.d(t,"g",(function(){return u})),s.d(t,"f",(function(){return m})),s.d(t,"d",(function(){return j})),s.d(t,"h",(function(){return y}));var a=s(1),r=s(16),n=s(152),d=s(62);var o=new class{getOrders(e){return d.a.get("/orders/status/"+e,{headers:Object(n.a)()})}getPaymentTransactions(e,t,s){return d.a.get("/orders/payments",{headers:Object(n.a)(),params:{query:e,page:t,limit:s}})}updateOrderPaymentStatus(e,t){return d.a.put("/orders/"+e+"/paid/"+t,{},{headers:Object(n.a)()})}placeOrderDetails(e){return d.a.post("/orders/checkout",{customerAddressId:e.addressId,paymentId:e.paymentMethodId,cartItems:e.items},{headers:Object(n.a)()})}getOrderByOrderId(e){return d.a.get("/orders/"+e,{headers:Object(n.a)()})}updateOrderStatus(e,t){return d.a.put("/orders/"+e+"/status/"+t,{},{headers:Object(n.a)()})}validateCart(e){return d.a.post("/orders/validate",e,{headers:Object(n.a)()})}};const c=(e,t)=>{const s=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),a=e.response&&e.response.data&&e.response.data.code||e.toString();t({type:r.g,payload:{status:a,data:{message:s}}})},i=(e,t,s)=>async r=>o.getOrders(e,t,s).then((e=>(r({type:a.GET_ORDERS,payload:{status:200,action:"GET_ORDERS",data:{orders:e.data.orders,orderStatusCount:e.data.orderCounts}}}),Promise.resolve())),(e=>(c(e,r),Promise.reject()))),l=e=>async t=>{t({type:a.ORDER_ITEMS,payload:{status:200,action:"ORDERITEMS",data:{items:e}}})},p=e=>async t=>o.placeOrderDetails(e).then((e=>(t({type:a.PLACE_ORDER,payload:{status:200,action:"PLACE_ORDER",data:{}}}),t({type:r.g,payload:{status:200,data:{message:"Successfully Place your Order",order:e.data}}}),Promise.resolve())),(e=>(c(e,t),Promise.reject()))),h=e=>async t=>o.getOrderByOrderId(e).then((e=>(t({type:a.GET_ORDER_BY_ID,payload:{status:200,action:"GETORDERBYID",data:{order:e.data}}}),Promise.resolve())),(e=>(c(e,t),Promise.reject()))),u=(e,t)=>async s=>o.updateOrderStatus(e,t).then((n=>(s({type:a.UPDATE_ORDER_STATUS,payload:{status:200,action:a.UPDATE_ORDER_STATUS,data:{order:n.data}}}),s({type:r.g,payload:{status:200,data:{message:"Successfully updated order "+e+" status to "+t.toUpperCase(),order:n.data}}}),Promise.resolve())),(e=>(c(e,s),Promise.reject()))),m=(e,t)=>async s=>o.updateOrderPaymentStatus(e,t).then((e=>(s({type:a.UPDATE_PAYMENT_STATUS,payload:{status:200,action:a.UPDATE_PAYMENT_STATUS,data:{order:e.data}}}),s({type:r.g,payload:{status:200,data:{}}}),Promise.resolve())),(e=>(c(e,s),Promise.reject()))),j=(e,t,s)=>async r=>o.getPaymentTransactions(e,t,s).then((e=>(r({type:a.GET_PAYMENT_TRANSACTIONS,payload:{status:200,action:"GET_PAYMENT_TRANSACTIONS",data:{payments:e.data}}}),Promise.resolve())),(e=>(c(e,r),Promise.reject()))),y=e=>async t=>o.validateCart(e).then((e=>(t({type:a.VALIDATE_CART,payload:{status:200,action:a.VALIDATE_CART,data:e.data}}),e.data.error_messages.length>0&&t({type:r.g,payload:{status:400,data:{message:e.data.error_messages.join("\n")}}}),Promise.resolve())),(e=>(c(e,t),Promise.reject())))},819:function(e,t,s){"use strict";s.r(t),s.d(t,"Cart",(function(){return x}));var a=s(0),r=s.n(a),n=s(568),d=s(156),o=s(48),c=s(573),i=s(642),l=s(571),p=s(26),h=s(580),u=s(15),m=s(154),j=s(7);const y=r.a.lazy((()=>s.e(72).then(s.bind(null,1299)))),g=r.a.lazy((()=>Promise.all([s.e(4),s.e(50)]).then(s.bind(null,1300)))),O=r.a.lazy((()=>s.e(73).then(s.bind(null,1304)))),b=r.a.lazy((()=>s.e(71).then(s.bind(null,1301))));class x extends a.Component{constructor(...e){super(...e),this.state={step:1,items:[],Tquantity:0,Tamount:0,isLoggedIn:!1,permission:"",addressId:void 0,paymentMethodId:void 0,successfull:!1,loading:!1,redirectUrl:"",clientRef:null,checkout:!1},this.manageCartItemsResponse=(e,t)=>{if(e.cartResponse!==this.props.cartResponse){let{action:e,status:t,data:s}=this.props.cartResponse;"CARTITEMS"===e&&200===t&&this.setState({cart:s.cart,items:[],Tamount:0,Tquantity:0})}},this.redirectUser=()=>{const e=this.props.userResponse.isLoggedIn;if(e){let t=this.props.userResponse.credentials.roles.roleName,s=t||this.props.userResponse.credentials.roles;this.setState({isLoggedIn:e,permission:s})}},this.handleCartOnChange=(e,t,s)=>{this.setState({items:e,Tquantity:t,Tamount:s})},this.handleAddressOnChange=e=>{this.setState({addressId:e})},this.handlePaymentMethodOnChange=e=>{this.setState({paymentMethodId:e})},this.handleOnNext=()=>{let{step:e}=this.state;if(1!==e)3!==e&&this.setState({step:++e});else{this.checkoutLock();const{cart:t,items:s}=this.state,a={cartId:t.cartId,accountId:t.accountId,items:s};this.props.validateCart(a).then((t=>{this.props.orderResponse.data.is_invalidate||this.setState({step:++e})}))}},this.sendMessage=(e="checkout",t={})=>{this.state.clientRef.sendMessage("/app/websocket/inventory",JSON.stringify({from:"test",message:t,eventType:e}))},this.checkoutLock=()=>{const{cart:e,items:t}=this.state;this.sendMessage("checkout",{cartId:e.cartId,accountId:e.accountId,items:t})},this.releaseCheckoutLock=()=>{const{cart:e,items:t}=this.state;this.sendMessage("release_checkout",{cartId:e.cartId,accountId:e.accountId,items:t})},this.handleOnPre=()=>{let{step:e}=this.state;1!==e&&(2===e&&(this.releaseCheckoutLock(),this.setState({items:[]})),this.setState({step:--e}))},this.renderSteps=()=>{let{step:e,addressId:t,paymentMethodId:s}=this.state,a=Object(j.jsx)(y,{paymentDetailsOnChange:this.handleCartOnChange});switch(e){case 1:return a=Object(j.jsx)(y,{paymentDetailsOnChange:this.handleCartOnChange}),a;case 2:return a=Object(j.jsx)(g,{checkValueOnChange:this.handleAddressOnChange,getValue:t}),a;case 3:return a=Object(j.jsx)(O,{paymentMethodOnChange:this.handlePaymentMethodOnChange,getValue:s}),a;default:return a}},this.renderHeader=()=>{let{step:e}=this.state,t="Shopping Cart";switch(e){case 1:return"Shopping Cart";case 2:return"Customer Address";case 3:return"Payment Method";case 4:return"";default:return t}},this.handleOnPlaceOrder=e=>{let{addressId:t,paymentMethodId:s,items:a}=this.state,r={addressId:t,paymentMethodId:s,items:a};this.setState({loading:!0}),this.props.placeOrder(r).then((()=>{let{data:e}=this.props.messageResponse;this.setState({successfull:!0,loading:!1,step:4,redirectUrl:e.order.redirectUrl})})).catch((()=>{this.setState({successfull:!1,loading:!1})}))}}componentDidMount(){if(this.props.userResponse.isLoggedIn?this.redirectUser():h.a.push(p.a.api.private.prefixFrontendUrl+"/login"),this.props.websocketResponse&&this.setState({clientRef:this.props.websocketResponse.data.clientRef}),this.props.userResponse.isLoggedIn){const{orderId:e,paymentStatus:t}=this.props.match.params;"success"!=t&&"failed"!=t||this.props.updateOrderPaymentStatus(e,t),this.setState({successfull:"success"==t})}}componentDidUpdate(e,t){if(this.props.websocketResponse!==e.websocketResponse)if("WEBSOCKET_REF"==this.props.websocketResponse.action){let e=this.props.websocketResponse.data.clientRef;this.setState({clientRef:e})}else if("WEBSOCKET_EVENT"==this.props.websocketResponse.action){let{cart:e}=this.state;const t=this.props.websocketResponse.data.message;if(e.accountId!=t.accountId){let s=e.cartItems;s.forEach(((e,a)=>{let r=t.items.findIndex((t=>t.product.id==e.product.product.id));s[a].product.inventory=t.items[r].inventory})),e.cartItems=s,console.log(l.e),this.props.setCart(e)}}this.manageCartItemsResponse(e,t)}render(){let{step:e,items:t,Tamount:s,Tquantity:r,isLoggedIn:o,permission:c,addressId:i,paymentMethodId:l,successfull:h,loading:y,redirectUrl:g}=this.state;const O={fontWeight:"800"};if(o){if(c===m.a.SUPER_ADMIN||c===m.a.ADMIN)return Object(j.jsx)(u.a,{to:p.a.api.private.prefixFrontendUrl+"/app"})}else if(!this.props.userResponse.isLoggedIn)return Object(j.jsx)(u.a,{to:p.a.api.private.prefixFrontendUrl+"/login"});return h&&""!=g&&g?(window.location.replace(g),Object(j.jsx)(j.Fragment,{})):Object(j.jsx)("div",{children:Object(j.jsxs)(a.Suspense,{fallback:Object(j.jsx)("div",{className:"d-flex justify-content-center align-items-center  position-fixed spinner",children:Object(j.jsx)(d.DotLoader,{color:"#36D7B7",size:100})}),children:[Object(j.jsx)(n.bb,{children:Object(j.jsx)("h3",{className:"mt-2 mb-4",children:this.renderHeader()})}),h?Object(j.jsx)(b,{}):Object(j.jsxs)(n.bb,{children:[Object(j.jsx)(n.q,{sm:"12",lg:"8",children:this.renderSteps()}),Object(j.jsx)(n.q,{sm:"12",lg:"4",className:"mb-5",children:Object(j.jsxs)(n.i,{children:[Object(j.jsx)(n.m,{children:Object(j.jsx)("span",{className:"",style:{fontSize:"18px",...O},children:"Summary Payment"})}),Object(j.jsxs)(n.j,{className:"border-bottom",children:[Object(j.jsxs)("div",{className:"d-flex justify-content-between bg-light p-2",children:[Object(j.jsx)("div",{children:Object(j.jsx)("span",{style:{...O},children:"Item"})}),Object(j.jsx)("div",{children:Object(j.jsx)("span",{style:{...O},children:"Quantity"})}),Object(j.jsx)("div",{children:Object(j.jsx)("span",{style:{...O},children:"Amount"})}),Object(j.jsx)("div",{children:Object(j.jsx)("span",{style:{...O},children:"Sub Amount"})})]}),t.length>0?t.map(((e,t)=>{const{promo:s,product:a}=e.product,r=s&&s.status,n=s&&s.percentage;let d=a.productPrice*n/100,o=a.productPrice-d;return"ONGOING"===r?o:a.productPrice,Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[Object(j.jsx)("span",{className:"text-truncate d-inline-block",style:{maxWidth:"150px"},children:a.productName}),Object(j.jsx)("span",{children:e.quantity}),Object(j.jsxs)("span",{children:["\u20b1","ONGOING"===r?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"text-muted text-decoration-line-through me-2",style:{fontSize:"16px"},children:a.productPrice.toFixed(2)}),Object(j.jsx)("span",{children:o.toFixed(2)})]}):a.productPrice.toFixed(2)]}),Object(j.jsxs)("span",{children:["\u20b1",(o*e.quantity).toFixed(2)]})]},e.id)})})):Object(j.jsx)(n.q,{style:{fontStyle:"italic",textAlign:"center"},className:"p-2",children:"No Item"})]}),Object(j.jsxs)("div",{className:"p-3 ",children:[Object(j.jsxs)("div",{className:"d-flex justify-content-between align-items-center pb-2",children:[Object(j.jsx)("span",{className:"text-muted font-style me-2",children:"Total Quantity"}),Object(j.jsx)("span",{style:{fontWeight:"500"},children:r})]}),Object(j.jsxs)("div",{className:"d-flex justify-content-between align-items-center pb-2",children:[Object(j.jsx)("span",{className:"text-muted font-style me-2",children:"Total Amount"}),Object(j.jsxs)("span",{style:{fontWeight:"500"},children:["\u20b1",s.toFixed(2)]})]})]}),Object(j.jsx)(n.k,{children:Object(j.jsx)("div",{className:"d-grid gap-2 mx-auto",children:e>1?Object(j.jsxs)("div",{className:"d-grid gap-2 d-md-flex justify-content-md-end",children:[Object(j.jsx)(n.f,{variant:"ghost",color:"dark",onClick:this.handleOnPre,className:"w-100",children:"Back"}),3===e?Object(j.jsxs)(n.f,{className:"w-100",color:"info",disabled:void 0===l,onClick:this.handleOnPlaceOrder,children:[y&&Object(j.jsx)(n.gb,{size:"sm",className:"ms-1"}),"Place Order"]}):Object(j.jsx)(n.f,{className:"w-100",color:"info",onClick:this.handleOnNext,disabled:void 0===i,children:"Next"})]}):Object(j.jsx)(n.f,{type:"submit",color:"info",disabled:t.length<=0,className:"d-flex justify-content-center align-items-center",onClick:this.handleOnNext,children:Object(j.jsx)("span",{className:"ms-2",children:"Checkout"})})})})]})})]})]})})}}t.default=Object(o.b)((e=>({userResponse:e.userResponse,messageResponse:e.messageResponse,websocketResponse:e.websocketResponse,cartResponse:e.cartResponse,orderResponse:e.orderResponse})),{clearMessage:c.a,placeOrder:i.e,updateOrderPaymentStatus:i.f,validateCart:i.h,setCart:l.e})(x)}}]);
//# sourceMappingURL=53.db09b8d6.chunk.js.map